<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vertigo - Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒØ²Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ</title>
  <style>
    :root {
      --bg: #f0f0f0;
      --text: #222;
      --card: #fff;
      --accent: #007bff;
    }
    body.dark {
      --bg: #1a1a1a;
      --text: #f5f5f5;
      --card: #2a2a2a;
      --accent: #66b2ff;
    }
    body {
      font-family: sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      background-image: repeating-linear-gradient(45deg, rgba(0,0,0,0.01) 0, rgba(0,0,0,0.01) 1px, transparent 1px, transparent 20px),
                        url('data:image/svg+xml;utf8,<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg"><text x="0" y="100" fill="rgba(0,0,0,0.05)" font-size="40" font-family="Arial" transform="rotate(-45)">Vertigo</text></svg>');
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: var(--card);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    header button, header .icon {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 24px;
      color: var(--text);
      transition: transform 0.3s;
    }
    header button:hover, .icon:hover {
      transform: scale(1.1);
    }
    #tables {
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: flex-start;
    }
    .table {
      background: var(--card);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      min-width: 250px;
      flex: 0 1 calc(33.333% - 40px);
      position: relative;
    }
    .settled {
      background-color: #ccc !important;
    }
    #total {
      padding: 20px;
      font-size: 20px;
      text-align: center;
    }
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .popup-content {
      background: var(--card);
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 300px;
    }
    .popup-content button {
      margin: 10px;
    }
    .delete-btn {
      position: absolute;
      top: 5px;
      left: 5px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <button class="icon" onclick="addTable()">â•</button>
    </div>
    <div>
      <button class="icon" onclick="toggleDarkMode()">ğŸŒ“</button>
    </div>
  </header>

  <div id="tables"></div>

  <div id="total">Ø¬Ù…Ø¹ Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ù…Ø±ÙˆØ²: <span id="total-income">0</span> ØªÙˆÙ…Ø§Ù†</div>

  <div style="text-align: center; margin-bottom: 20px;">
    <button onclick="showEndDayPopup()">Ù¾Ø§ÛŒØ§Ù† Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ</button>
  </div>

  <div class="popup" id="popup">
    <div class="popup-content">
      <p id="popup-msg">Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ù…Ø±ÙˆØ² Ú¯ÛŒÙ…â€ŒÙ†Øª ÙˆØ±ØªÛŒÚ¯Ùˆ: <span id="popup-income"></span> ØªÙˆÙ…Ø§Ù†</p>
      <button onclick="confirmEndDay()">ØªØ§ÛŒÛŒØ¯</button>
      <button onclick="closePopup()">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>

  <script>
    let tables = JSON.parse(localStorage.getItem('tables')) || [
      { id: 1, type: 'PS5', rate: 45000 },
      { id: 2, type: 'PS5', rate: 45000 },
      { id: 3, type: 'PS5', rate: 45000 },
      { id: 4, type: 'PS5', rate: 45000 },
      { id: 5, type: 'PS5', rate: 45000 },
      { id: 6, type: 'Ø¨ÛŒÙ„ÛŒØ§Ø±Ø¯', rate: 100000 }
    ];

    let sessions = JSON.parse(localStorage.getItem('sessions')) || {};
    let totalIncome = parseInt(localStorage.getItem('totalIncome')) || 0;
    document.getElementById("total-income").textContent = totalIncome.toLocaleString();

    tables.forEach(renderTable);
    setInterval(updateTimers, 1000);

    function renderTable(table) {
      const div = document.createElement('div');
      div.className = 'table';
      div.id = `table-${table.id}`;
      div.innerHTML = `
        <button class="delete-btn" onclick="removeTable(${table.id})">Ã—</button>
        <h3>Ù…ÛŒØ² ${table.id} (${table.type})</h3>
        <label>Ù‡Ø²ÛŒÙ†Ù‡ Ù‡Ø± Ø³Ø§Ø¹Øª: <input type="number" id="rate-${table.id}" value="${table.rate}"></label><br>
        <p>Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹: <span id="start-${table.id}">--:--:--</span></p>
        <p>Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù†: <span id="end-${table.id}">--:--:--</span></p>
        <p>Ù…Ø¯Øª: <span id="duration-${table.id}">--:--:--</span></p>
        <p>Ù‡Ø²ÛŒÙ†Ù‡: <span id="cost-${table.id}">0</span> ØªÙˆÙ…Ø§Ù†</p>
        <button onclick="startGame(${table.id})">Ø´Ø±ÙˆØ¹</button>
        <button onclick="endGame(${table.id})">Ù¾Ø§ÛŒØ§Ù†</button>
        <button onclick="settle(${table.id})">ØªØ³ÙˆÛŒÙ‡</button>
      `;
      document.getElementById("tables").appendChild(div);
      if (sessions[table.id]) {
        document.getElementById(`start-${table.id}`).textContent = new Date(sessions[table.id].start).toLocaleTimeString('fa-IR');
        if (sessions[table.id].end) {
          document.getElementById(`end-${table.id}`).textContent = new Date(sessions[table.id].end).toLocaleTimeString('fa-IR');
          document.getElementById(`cost-${table.id}`).textContent = sessions[table.id].cost.toLocaleString();
        }
      }
    }

    function startGame(id) {
      sessions[id] = { start: new Date().toISOString() };
      localStorage.setItem("sessions", JSON.stringify(sessions));
      document.getElementById(`start-${id}`).textContent = new Date().toLocaleTimeString('fa-IR');
    }

    function endGame(id) {
      if (!sessions[id]?.start) return alert("Ø§Ø¨ØªØ¯Ø§ Ø´Ø±ÙˆØ¹ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.");
      const end = new Date();
      const start = new Date(sessions[id].start);
      const rate = parseInt(document.getElementById(`rate-${id}`).value);
      const hours = (end - start) / (1000 * 60 * 60);
      const cost = Math.ceil(hours * rate);
      sessions[id].end = end.toISOString();
      sessions[id].cost = cost;
      localStorage.setItem("sessions", JSON.stringify(sessions));
      totalIncome += cost;
      localStorage.setItem("totalIncome", totalIncome);
      document.getElementById("total-income").textContent = totalIncome.toLocaleString();
      document.getElementById(`end-${id}`).textContent = end.toLocaleTimeString('fa-IR');
      document.getElementById(`cost-${id}`).textContent = cost.toLocaleString();
    }

    function updateTimers() {
      for (let id in sessions) {
        if (sessions[id]?.start && !sessions[id].end) {
          const now = new Date();
          const start = new Date(sessions[id].start);
          const diff = new Date(now - start);
          const h = String(diff.getUTCHours()).padStart(2, '0');
          const m = String(diff.getUTCMinutes()).padStart(2, '0');
          const s = String(diff.getUTCSeconds()).padStart(2, '0');
          document.getElementById(`duration-${id}`).textContent = `${h}:${m}:${s}`;
        }
      }
    }

    function settle(id) {
      delete sessions[id];
      localStorage.setItem("sessions", JSON.stringify(sessions));
      document.getElementById(`start-${id}`).textContent = "--:--:--";
      document.getElementById(`duration-${id}`).textContent = "--:--:--";
    }

    function addTable() {
      const type = prompt("Ù†ÙˆØ¹ Ù…ÛŒØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:", "PS5");
      if (!type) return;
      const rate = type === 'Ø¨ÛŒÙ„ÛŒØ§Ø±Ø¯' ? 100000 : 45000;
      const id = tables.length ? tables[tables.length - 1].id + 1 : 1;
      const table = { id, type, rate };
      tables.push(table);
      localStorage.setItem("tables", JSON.stringify(tables));
      renderTable(table);
    }

    function removeTable(id) {
      tables = tables.filter(t => t.id !== id);
      delete sessions[id];
      localStorage.setItem("tables", JSON.stringify(tables));
      localStorage.setItem("sessions", JSON.stringify(sessions));
      document.getElementById(`table-${id}`).remove();
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
      localStorage.setItem('darkMode', document.body.classList.contains('dark'));
    }

    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark');
    }

    function showEndDayPopup() {
      document.getElementById("popup-income").textContent = totalIncome.toLocaleString();
      document.getElementById("popup").style.display = "flex";
    }

    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }

    function confirmEndDay() {
      totalIncome = 0;
      sessions = {};
      localStorage.removeItem("sessions");
      localStorage.setItem("totalIncome", "0");
      document.getElementById("total-income").textContent = "0";
      document.querySelectorAll(".table").forEach(div => {
        div.querySelector(`#start-${div.id.split('-')[1]}`).textContent = "--:--:--";
        div.querySelector(`#duration-${div.id.split('-')[1]}`).textContent = "--:--:--";
        div.querySelector(`#end-${div.id.split('-')[1]}`).textContent = "--:--:--";
        div.querySelector(`#cost-${div.id.split('-')[1]}`).textContent = "0";
      });
      closePopup();
    }
  </script>
</body>
</html>
